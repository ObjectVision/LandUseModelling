// ///////////////////////////////////////////////////////////////////////////////////////
//                                                                                      //
//                 Configuration Land Use Scanner - Student Edition                     //
//                          using GeoDMS version 7.130 or newer                         //
//                                                                                      //
//                                July 2004 - January 2023                              //
//                                                                                      //
//                            Vrije Universiteit Amsterdam                              //
//                            Spatial Information Laboratory                            //
//                Dr. Jasper Dekkers & Dr. Eric Koomen & Jip Claassens                  //
//                                                                                      //
// ///////////////////////////////////////////////////////////////////////////////////////
//                                                                                      //
// This is the base file for the configuration                                          //
//                                                                                      //
// Using include-statements, this file refers to the dms-files with:                    //
// - Units                                                                  (Units.dms) //
// - Geography                                                          (geography.dms) //
// - Classifications                                              (Classifications.dms) //
// - Present landuse (landuse, thematic_maps, policy_maps, DistanceDecay) (Present.dms) //
// - Components for determining future landuse                 (ScenarioComponents.dms) //
// - Algorithms procedures (continuous & discrete)          (Allocation_Procedures.dms) //
// - Simulations for future landuse                                   (Simulations.dms) //
//                                                                                      //
// ///////////////////////////////////////////////////////////////////////////////////////

container regression_test: IntegrityCheck = "GeoDmsVersion() >= 7.130"
{
	#include <%projDir%/cfg/demo/Units.dms>
	#include <%projDir%/cfg/demo/Geography.dms>
	#include <%projDir%/cfg/demo/Classifications.dms>
	#include <%projDir%/cfg/demo/Templates.dms>
	#include <%projDir%/cfg/demo/Current_situation.dms>
	#include <%projDir%/cfg/demo/ScenarioComponents.dms>

	container Allocation_procedures: Using = "Units;geography;Classifications;Templates", isHidden = "True"
	{
		#include <%projDir%/cfg/demo/Allocation_Procedures.dms>
	}

	#include <%projDir%/cfg/demo/Simulations.dms>
	
	container test
	{
		container MakeReference
		{
			unit<spoint> discrete := Geography/rdc_500lu
			{
				attribute<uint8> A1_GE (Geography/rdc_500lu) := Simulations/A1_GE/Results/Discrete/LandUse/Model, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_A1_GE.fss";
				attribute<uint8> A2_TM (Geography/rdc_500lu) := Simulations/A2_TM/Results/Discrete/LandUse/Model, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_A2_TM.fss";
				attribute<uint8> B1_SE (Geography/rdc_500lu) := Simulations/B1_SE/Results/Discrete/LandUse/Model, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_B1_SE.fss";
				attribute<uint8> B2_RC (Geography/rdc_500lu) := Simulations/B2_RC/Results/Discrete/LandUse/Model, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_B2_RC.fss";
			}
			unit<spoint> continuous := Geography/rdc_500lu
			{
				attribute<uint8> A1_GE (Geography/rdc_500lu) := Simulations/A1_GE/results/Continuous/LandUse/Predominant, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_A1_GE.fss";
				attribute<uint8> A2_TM (Geography/rdc_500lu) := Simulations/A2_TM/results/Continuous/LandUse/Predominant, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_A2_TM.fss";
				attribute<uint8> B1_SE (Geography/rdc_500lu) := Simulations/B1_SE/results/Continuous/LandUse/Predominant, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_B1_SE.fss";
				attribute<uint8> B2_RC (Geography/rdc_500lu) := Simulations/B2_RC/results/Continuous/LandUse/Predominant, StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_B2_RC.fss";
			}
		}
		container UseReference
		{
			container recorded
			{
				container discrete
				{
					attribute<uint8> A1_GE (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_A1_GE.fss";
					attribute<uint8> A2_TM (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_A2_TM.fss";
					attribute<uint8> B1_SE (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_B1_SE.fss";
					attribute<uint8> B2_RC (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/discr_B2_RC.fss";
				}
				container continuous
				{
					attribute<uint8> A1_GE (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_A1_GE.fss";
					attribute<uint8> A2_TM (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_A2_TM.fss";
					attribute<uint8> B1_SE (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_B1_SE.fss";
					attribute<uint8> B2_RC (Geography/rdc_500lu) : StorageName = "%SourceDataDir%/OperatorLarge/lus_demo/cont_B2_RC.fss";
				}
			}
			container test
			{
				container discrete
				{
					attribute<bool> A1_GE (Geography/rdc_500lu) := Simulations/A1_GE/Results/Discrete/LandUse/Model == recorded/discrete/A1_GE;
					attribute<bool> A2_TM (Geography/rdc_500lu) := Simulations/A2_TM/Results/Discrete/LandUse/Model == recorded/discrete/A2_TM;
					attribute<bool> B1_SE (Geography/rdc_500lu) := Simulations/B1_SE/Results/Discrete/LandUse/Model == recorded/discrete/B1_SE;
					attribute<bool> B2_RC (Geography/rdc_500lu) := Simulations/B2_RC/Results/Discrete/LandUse/Model == recorded/discrete/B2_RC;
				}
				container continuous
				{
					attribute<bool> A1_GE (Geography/rdc_500lu) := Simulations/A1_GE/results/Continuous/LandUse/Predominant == recorded/continuous/A1_GE;
					attribute<bool> A2_TM (Geography/rdc_500lu) := Simulations/A2_TM/results/Continuous/LandUse/Predominant == recorded/continuous/A2_TM;
					attribute<bool> B1_SE (Geography/rdc_500lu) := Simulations/B1_SE/results/Continuous/LandUse/Predominant == recorded/continuous/B1_SE;
					attribute<bool> B2_RC (Geography/rdc_500lu) := Simulations/B2_RC/results/Continuous/LandUse/Predominant == recorded/continuous/B2_RC;
				}
			}
			parameter <bool> all := 
				   all(test/discrete/A1_GE)   && all(test/discrete/A2_TM)   && all(test/discrete/B1_SE)   && all(test/discrete/B1_SE)
				&& all(test/continuous/A1_GE) && all(test/continuous/A2_TM) && all(test/continuous/B1_SE) && all(test/continuous/B1_SE);

			container t610_lus_demo_results_test
			{
				parameter<string> TempDir          := '%LocalDataDir%/tstlog_large';
				parameter<string> ver_key_filename := TempDir + '/temp_ver_key.txt';
				parameter<string> ver_key          :  Storagename =  "= ver_key_filename", StorageType = "str";

				parameter<string> result := all ? 'OK' : 'False';
				
				parameter<uint32>  nr_col := uint32(max(PointCol(id(Geography/rdc_500lu)))) + 1;
				parameter<uint32>  nr_row := uint32(max(PointRow(id(Geography/rdc_500lu)))) + 1;
				
				parameter<string> size   := string(nr_col * nr_row);
	
				parameter<string> result_html := 
					'<description>LUS Demo discrete allocation results, http://svn.objectvision.nl/public/geodms/trunk/prj/lus_demo, revision: 12147</description>'+
					'<size>4 discrete allocation and 4 continuous results on ' + size + ' cells</size>' +
					'<result>'+ result + '</result>'
				,	StorageType = "str"
				,	storagename = "= '%SourceDataDir%/GeoDMSTestResults' + '/' + ver_key + '/t610_lus_demo_results_test.txt'";
				
			}
		}
	}
}
